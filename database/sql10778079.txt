-- Criando a tabela de tipos de usuários
CREATE TABLE tipo_usuario (
    id_tipo INT PRIMARY KEY AUTO_INCREMENT,
    tipo VARCHAR(35) NOT NULL
);

-- Criando a tabela de pessoas
CREATE TABLE pessoa (
    id_pessoa INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(40) NOT NULL,
    email VARCHAR(50) NOT NULL,
    telefone VARCHAR(15) NOT NULL,
    cpf VARCHAR(18) NOT NULL UNIQUE,
    id_tipo_usuario INT NOT NULL, 
    FOREIGN KEY (id_tipo_usuario) REFERENCES tipo_usuario(id_tipo),
    senha VARCHAR(255) NOT NULL,
    situacao ENUM('A','P','I') NOT NULL,
    imagem_perfil VARCHAR(255) NULL DEFAULT NULL,
    data_hora TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Criando a tabela de registros de acessos
CREATE TABLE acessos (
    id_acesso INT PRIMARY KEY AUTO_INCREMENT, 
    id_pessoa INT NOT NULL,
    FOREIGN KEY (id_pessoa) REFERENCES pessoa(id_pessoa) ON DELETE CASCADE,
    data_hora TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Criando a tabela de pagamentos
CREATE TABLE pagamento (
    id_pagamento INT PRIMARY KEY AUTO_INCREMENT,
    pagamento_situacao CHAR(1) DEFAULT 'P',
    data_pagamento TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    id_f_pagamento INT NOT NULL,
    valor DECIMAL(10,2) NOT NULL,
    num_parcelas INT DEFAULT 1,
    parcelamento_situacao ENUM('Em aberto', 'Pago', 'Cancelado') NULL,
    transacao_id VARCHAR(100) UNIQUE NULL,
    bandeira_cartao VARCHAR(20) NULL,
    FOREIGN KEY (id_f_pagamento) REFERENCES forma_pagamento(id_f_pagamento)
);

-- Criando a tabela de pedidos
CREATE TABLE pedidos (
    id_pedido INT PRIMARY KEY AUTO_INCREMENT,
    data_hora TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    situacao CHAR(1) NOT NULL DEFAULT 'P',
    id_pessoa INT NOT NULL,
    FOREIGN KEY (id_pessoa) REFERENCES pessoa(id_pessoa),
    id_pagamento INT NOT NULL,
    FOREIGN KEY (id_pagamento) REFERENCES pagamento(id_pagamento),
    status_pagamento CHAR(1) NOT NULL DEFAULT 'P',
    endereco_entrega TEXT NULL,
    metodo_entrega VARCHAR(50) NULL
);

-- Criando a tabela de categorias de produtos
CREATE TABLE categoria (
    id_categoria INT PRIMARY KEY AUTO_INCREMENT,
    categoria VARCHAR(50) NOT NULL,
    descricao TEXT NULL
);


CREATE TABLE produto (
    id_produto INT PRIMARY KEY AUTO_INCREMENT,
    produto VARCHAR(80) NOT NULL,
    descricao TEXT NOT NULL,
    preco DECIMAL(10,2) NOT NULL,
    marca VARCHAR(20) NULL DEFAULT NULL,
    avaliacao DECIMAL(5,2) NULL DEFAULT NULL,
    estoque INT NOT NULL,
    parcelas_permitidas INT NOT NULL DEFAULT 1,
    imagem_1 VARCHAR(255) NOT NULL,
    imagem_2 VARCHAR(255) NULL DEFAULT NULL,
    categoria INT NOT NULL,
    FOREIGN KEY (categoria) REFERENCES categoria(id_categoria) ON DELETE CASCADE
);

INSERT INTO categoria (categoria, descricao) VALUES
('Moda Sustentável', 'Roupas e acessórios feitos com materiais ecológicos e métodos de produção éticos.'),
('Cosméticos Naturais', 'Produtos de beleza e cuidados pessoais feitos com ingredientes naturais e sem testes em animais.'),
('Casa Ecológica', 'Produtos para a casa feitos com materiais sustentáveis e eficientes em termos de energia.'),
('Alimentos Orgânicos', 'Alimentos produzidos sem o uso de pesticidas e fertilizantes químicos.'),
('Transporte Sustentável', 'Veículos elétricos, bicicletas e outros meios de transporte ecologicamente corretos.'),
('Reciclagem e Reutilização', 'Produtos feitos a partir de materiais reciclados ou que incentivam a reutilização e redução de resíduos.'),
('Jardinagem Orgânica', 'Ferramentas, sementes e insumos para a jardinagem orgânica e cultivo sustentável.'),
('Educação e Conscientização', 'Livros, cursos e materiais educacionais sobre sustentabilidade e meio ambiente.'),
('Energia Renovável', 'Produtos e soluções baseadas em energia solar, eólica e outras fontes renováveis.'),
('Bem-estar Sustentável', 'Itens para saúde e bem-estar que promovem práticas naturais e sustentáveis.'),
('Tecnologia Verde', 'Dispositivos e soluções tecnológicas voltadas para a sustentabilidade e redução de impacto ambiental.');

-- Inserindo tipos de usuários
INSERT INTO tipo_usuario (tipo) VALUES
('Administrador'),
('Usuário');

-- Inserindo usuários
INSERT INTO pessoa (nome, email, telefone, cpf, id_tipo_usuario, senha, situacao, imagem_perfil) VALUES
('Kauã', 'kaua@email.com', '61999990001', '111.222.333-44', 1, 'senhaKaua', 'A', NULL),
('Gabriel', 'gabriel@email.com', '61999990002', '222.333.444-55', 1, 'senhaGabriel', 'A', NULL),
('Edenilson', 'edenilson@email.com', '61999990003', '333.444.555-66', 1, 'senhaEdenilson', 'A', NULL),
('Guilherme', 'guilherme@email.com', '61999990004', '444.555.666-77', 2, 'senhaGuilherme', 'A', NULL),
('Fabrício', 'fabricio@email.com', '61999990005', '555.666.777-88', 2, 'senhaFabricio', 'A', NULL);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Camisa Preta', 'Camisa 100% algodão', 59.99, 4.50, 1, 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR-Apd-5qaDSGuKucXJMEhmqPELT7w_7ywxPA&s', 1);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Tênis Branco', 'Esportivo confortável', 199.90, 3.70, 0, 'https://cdnv2.moovin.com.br/napolitanacalcados/imagens/produtos/det/tenis-adidas-hp5930-649e2a507d880757d804772fd961402d.jpg', 1);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Escova de Dentes de Bambu', 'Feita com bambu 100% biodegradável.', 14.90, 4.60, 0, 'https://images.tcdn.com.br/img/img_prod/671855/kit_com_10_escovas_de_dente_de_bambu_2079_1_5888ce07ca6053a48a94fa12f2b07d6f.jpg', 2);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Shampoo Sólido Natural', 'Sem plástico, sem químicas pesadas, Com óleos essenciais e ingredientes naturais.', 32.00, 4.80, 0, 'https://acdn-us.mitiendanube.com/stores/001/492/053/products/14250195559-shampoo-solido-1-cd29735917944cd23016297759347332-1024-1024.jpg', 2);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Canudos Reutilizáveis de Inox', 'Chega de plástico descartável! Canudos feitos de inox.', 19.90, 4.50, 0, 'https://images.tcdn.com.br/img/img_prod/1004735/kit_com_4_canudos_inox_reutilizaveis_reto_curvo_com_escova_higienica_75_1_046d7c7267c8fc31f95ee618b4e8fb43.jpg', 6);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Bee Wrap (Embalagem de Cera de Abelha)', 'Pano de algodão coberto com cera de abelha. Reutilizável, lavável.', 29.90, 4.30, 0, 'https://m.media-amazon.com/images/I/81-RFKZmXML._AC_UF894,1000_QL80_.jpg', 6);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Garrafa Térmica Sustentável', 'Design moderno, construção resistente e zero plástico.', 89.90, 4.70, 0, 'https://70730.cdn.simplo7.net/static/70730/sku/brindes-garrafas-e-squeezes-squeeze-garrafa-termica-sustentavel-550-ml-aco-inox-e-tampa-bambu-brindes-personalizados-bebidas-quentes-e-frias-p-1726872734169.jpg', 6);

INSERT INTO produto (produto, descricao, preco, avaliacao, estoque, imagem_1, categoria)  
VALUES ('Cafeteira Elétrica', 'Uma cafeteira top.', 199.90, 5.00, 1, 'https://www.keewe.com.br/media/uploads/162/2024/09/lpGwjI4vaq8AHaoJum3XcKhFt9tsUm9rtKU2zfdk.jpg', 3);

CREATE VIEW vw_produto_categoria AS
SELECT 
    p.id_produto,
    p.produto,
    p.descricao,
    p.preco,
    p.marca,
    p.avaliacao,
    p.estoque,
    p.parcelas_permitidas,
    p.imagem_1,
    p.imagem_2,
    c.categoria,
    c.descricao AS categoria_descricao
FROM produto p
JOIN categoria c ON p.categoria = c.id_categoria;